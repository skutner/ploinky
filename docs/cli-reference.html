<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLI Reference - Ploinky</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <div class="logo-icon">ðŸš€</div>
                    <span>Ploinky</span>
                </a>
                <nav>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="cli-reference.html" class="active">CLI Reference</a></li>
                        <li><a href="architecture.html">Architecture</a></li>
                        <li><a href="spec-agent.html">Agent Spec</a></li>
                        <li><a href="webchat.html">WebChat</a></li>
                        <li><a href="spec-webmeet.html">WebMeet</a></li>
                        <li><button class="theme-toggle" id="themeToggle">ðŸŒ™</button></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="doc-layout">
                <aside class="sidebar">
                    <h3>Quick Navigation</h3>
                    <ul>
                        <li><a href="#repository">Repository Management</a></li>
                        <li><a href="#agent">Agent Operations</a></li>
                        <li><a href="#workspace">Workspace Commands</a></li>
                        <li><a href="#variables">Variables & Environment</a></li>
                        <li><a href="#web">Web Interfaces</a></li>
                        <li><a href="#client">Client Operations</a></li>
                        <li><a href="#system">System Management</a></li>
                        <li><a href="#logs">Logging & Monitoring</a></li>
                    </ul>
                </aside>

                <div class="content-wrapper">
                    <div class="doc-section">
                        <h1>CLI Command Reference</h1>
                        <p>Complete reference for all Ploinky CLI commands. Commands are organized by category for easy navigation.</p>
                        <div class="alert alert-info">
                            <strong>Note on command prefixes:</strong> The commands in this documentation are shown without the <code>ploinky</code> prefix, assuming they are run from within the project's interactive shell. For global usage from your system's terminal, prepend each command with <code>ploinky</code> (e.g., <code>ploinky list agents</code>).
                        </div>
                    </div>

                    <div class="doc-section" id="repository">
                        <h2>Repository Management</h2>
                        
                        <h3>add repo</h3>
                        <p>Add a repository to your local environment.</p>
                        <pre><code>add repo &lt;name&gt; [url]</code></pre>
                        <table class="command-table">
                            <tr>
                                <th>Parameter</th>
                                <th>Description</th>
                            </tr>
                            <tr>
                                <td><code>&lt;name&gt;</code></td>
                                <td>Repository name (basic, cloud, vibe, security, extra, demo) or custom name</td>
                            </tr>
                            <tr>
                                <td><code>[url]</code></td>
                                <td>Git URL for custom repositories (optional for predefined repos)</td>
                            </tr>
                        </table>
                        <div class="alert alert-info">
                            <strong>Predefined repositories:</strong>
                            <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                                <li><strong>basic</strong> - Essential tools and shell environments</li>
                                <li><strong>cloud</strong> - AWS, Azure, GCP integrations</li>
                                <li><strong>vibe</strong> - Social media and communication tools</li>
                                <li><strong>security</strong> - Authentication and encryption utilities</li>
                                <li><strong>extra</strong> - Additional utilities and helpers</li>
                                <li><strong>demo</strong> - Example agents and tutorials</li>
                            </ul>
                        </div>
                        <pre><code># Examples
add repo cloud                                    # Add predefined cloud repository
add repo myrepo https://github.com/user/repo.git  # Add custom repository</code></pre>

                        <h3>enable repo</h3>
                        <p>Enable a repository for agent listings.</p>
                        <pre><code>enable repo &lt;name&gt;</code></pre>
                        <pre><code># Example
enable repo cloud</code></pre>

                        <h3>disable repo</h3>
                        <p>Disable a repository from agent listings.</p>
                        <pre><code>disable repo &lt;name&gt;</code></pre>

                        <h3>list repos</h3>
                        <p>List all available repositories and their status.</p>
                        <pre><code>list repos</code></pre>

                        <h3>update repo</h3>
                        <p>Pull latest changes from remote for a repository.</p>
                        <pre><code>update repo &lt;name&gt;</code></pre>
                        <pre><code># Example
update repo basic</code></pre>
                    </div>

                    <div class="doc-section" id="agent">
                        <h2>Agent Operations</h2>

                        <h3>enable agent</h3>
                        <p>Register an agent in workspace registry for management.</p>
                        <pre><code>enable agent &lt;name|repo/name&gt;</code></pre>
                        <pre><code># Examples
enable agent demo           # Enable demo agent from any repo
enable agent cloud/MyAPI    # Enable specific agent from cloud repo</code></pre>

                        

                        <h3>refresh agent</h3>
                        <p>Stops, removes, and re-creates the agent's container. This is a destructive operation that ensures the agent starts from a clean state. This command only has an effect if the agent's container is currently running.</p>
                        <pre><code>refresh agent &lt;name&gt;
# Example
refresh agent demo  # stop, remove, and re-create the container for the 'demo' agent</code></pre>

                        <h3>list agents</h3>
                        <p>List all available agents from enabled repositories.</p>
                        <pre><code>list agents</code></pre>
                    </div>

                    <div class="doc-section" id="workspace">
                        <h2>Workspace Commands</h2>
                        
                        <h3>start</h3>
                        <p>Start agents from .ploinky/agents and launch Router.</p>
                        <pre><code>start [staticAgent] [port]</code></pre>
                        <table class="command-table">
                            <tr>
                                <th>Parameter</th>
                                <th>Description</th>
                            </tr>
                            <tr>
                                <td><code>[staticAgent]</code></td>
                                <td>Primary agent to serve static files (required first time)</td>
                            </tr>
                            <tr>
                                <td><code>[port]</code></td>
                                <td>Router port (default: 8080)</td>
                            </tr>
                        </table>
                        <pre><code># First time setup
start demo 8080

# Subsequent starts (uses saved configuration)
start</code></pre>

                        <h3>shell</h3>
                        <p>Open interactive shell session in agent container.</p>
                        <pre><code>shell &lt;agentName&gt;</code></pre>
                        <div class="alert alert-warning">
                            Attaches to a persistent container with full TTY support. Exit shell by typing "exit" to return to host.
                        </div>

                        <h3>cli</h3>
                        <p>Run the agent's CLI command interactively.</p>
                        <pre><code>cli &lt;agentName&gt; [args...]</code></pre>
                        <pre><code># Examples
cli MyAPI --help
cli PyBot --version</code></pre>

                        <h3>WebTTY Agent Shortcuts</h3>
                        <p>Inside the Web Console/WebTTY, you can prefix a command with an agent name to run it inside that agentâ€™s container via its CLI.</p>
                        <pre><code># In WebTTY shell
demo whoami     # opens 'cli demo', runs 'whoami', exits; shows only the command output
demo ls /       # same: runs 'ls /' inside the demo container and prints only its output

# Notes
- Output is trimmed to the subcommandâ€™s result (not the intermediate 'cli demo'/'exit' steps).
- Requires the agent to define a <code>cli</code> command in its manifest; otherwise an error is shown.
- Works in WebTTY/WebConsole sessions that use bash (default). If bash is unavailable, the fallback shell may not support this shortcut.
- Equivalent to: open <code>cli &lt;agent&gt;</code>, run the subcommand, then exit.</code></pre>

                        <h3>status</h3>
                        <p>Show workspace status including agents, router, and web services.</p>
                        <pre><code>status</code></pre>

                        <h3>list routes</h3>
                        <p>List configured routes from <code>.ploinky/routing.json</code>.</p>
                        <pre><code>list routes</code></pre>
                        <pre><code># Example output
Routing configuration (.ploinky/routing.json):
- Port: 8088
- Static: agent=demo root=/path/to/demo/agent
Configured routes:
- demo: hostPort=7001 container=ploinky_project_service_demo</code></pre>

                        <h3>restart</h3>
                        <p>Restarts services. If an agent name is provided, it performs a non-destructive stop and start of that agent's container, preserving the container ID. This only affects running containers. If no agent name is provided, it restarts all agents and the router.</p>
                        <pre><code>restart [agentName]</code></pre>
                        <pre><code># Examples
restart          # Restart all agents and the router
restart MyAPI    # Stop and then start the existing container for MyAPI</code></pre>
                    </div>

                    <div class="doc-section" id="variables">
                        <h2>Variables & Environment</h2>
                        
                        <h3>var</h3>
                        <p>Set a workspace variable (stored in .ploinky/.secrets).</p>
                        <pre><code>var &lt;VAR&gt; &lt;value&gt;</code></pre>
                        <table class="command-table">
                            <tr>
                                <th>Variable</th>
                                <th>Description</th>
                                <th>Default</th>
                            </tr>
                            <tr>
                                <td><code>WEBTTY_TOKEN</code></td>
                                <td>WebConsole authentication token</td>
                                <td>(randomly generated)</td>
                            </tr>
                            <tr>
                                <td><code>WEBCHAT_TOKEN</code></td>
                                <td>WebChat authentication token</td>
                                <td>(randomly generated)</td>
                            </tr>
                            <tr>
                                <td><code>WEBDASHBOARD_TOKEN</code></td>
                                <td>Dashboard authentication token</td>
                                <td>(randomly generated)</td>
                            </tr>
                            <tr>
                                <td><code>WEBMEET_TOKEN</code></td>
                                <td>WebMeet authentication token</td>
                                <td>(randomly generated)</td>
                            </tr>
                        </table>
                        <pre><code># Examples
var API_KEY sk-123456789
var WEBTTY_TOKEN deadbeef
var WEBTTY_PORT 9000</code></pre>

                        <h3>vars</h3>
                        <p>List all workspace variables.</p>
                        <pre><code>vars</code></pre>

                        <h3>echo</h3>
                        <p>Print the resolved value of a variable.</p>
                        <pre><code>echo &lt;VAR|$VAR&gt;</code></pre>
                        <pre><code># Examples
echo API_KEY      # Show raw value
echo $PROD_KEY    # Show resolved alias</code></pre>

                        <h3>expose</h3>
                        <p>Expose variable to agent environment.</p>
                        <pre><code>expose &lt;ENV_NAME&gt; &lt;$VAR|value&gt; [agent]</code></pre>
                        <pre><code># Examples
expose DATABASE_URL $DB_URL myAgent
expose API_KEY $PROD_KEY            # Uses static agent</code></pre>
                    </div>

                    <div class="doc-section" id="web">
                        <h2>Web Interfaces</h2>
                        
                        <h3>webconsole / webtty</h3>
                        <p>Prepare access for the Web Console (synonyms). Prints URL with token.</p>
                        <pre><code>webconsole [shell]
webtty [shell]</code></pre>
                        <pre><code># Examples
webconsole
webtty sh
webtty /bin/zsh</code></pre>
                        <div class="alert alert-info">
                            Access at: http://127.0.0.1:8080/webtty?token=&lt;WEBTTY_TOKEN&gt;
                        </div>
                        <div class="alert alert-warning">
                            Shell options: sh, zsh, dash, ksh, csh, tcsh, fish, or absolute path. When a shell is provided, the router is restarted (if previously configured) so changes apply immediately; otherwise changes take effect on next start.
                        </div>

                        <h3>webchat</h3>
                        <p>Prepare access for the WebChat interface. Prints URL with token.</p>
                        <pre><code>webchat [--rotate]</code></pre>
                        <pre><code># Examples
webchat
webchat --rotate</code></pre>
                        <div class="alert alert-info">
                            Access at: http://127.0.0.1:8080/webchat?token=&lt;WEBCHAT_TOKEN&gt;
                        </div>

                        <h3>dashboard</h3>
                        <p>Prepare access for the Dashboard. Prints URL with token.</p>
                        <pre><code>dashboard</code></pre>
                        <div class="alert alert-info">
                            Access at: http://127.0.0.1:8080/dashboard?token=&lt;WEBDASHBOARD_TOKEN&gt;
                        </div>

                        <h3>webmeet</h3>
                        <p>Prepare access for WebMeet and optionally set a moderator agent. Prints URL with token.</p>
                        <pre><code>webmeet [moderatorAgent] [--rotate]</code></pre>
                        <table class="command-table">
                            <tbody><tr>
                                <th>Parameter</th>
                                <th>Description</th>
                            </tr>
                            <tr>
                                <td><code>[moderatorAgent]</code></td>
                                <td>Agent to use as moderator</td>
                            </tr>
                            <tr>
                                <td><code>--rotate</code></td>
                                <td>Generate a new token</td>
                            </tr>
                        </tbody></table>
                        <div class="alert alert-info">
                            Access at: http://localhost:8080/webmeet (proxied by the router)
                        </div>
                    </div>

                    <div class="doc-section" id="client">
                        <h2>Client Operations</h2>
                        
                        <h3>client task</h3>
                        <p>Sends a task to an agent. Parameters are passed as a series of key-value pairs, supporting nested objects, arrays, and quoted strings.</p>
                        <pre><code>client task &lt;agent&gt; [parameters...]</code></pre>
                        
                        <h4>Arguments</h4>
                        <table class="command-table">
                            <tr>
                                <th>Parameter</th>
                                <th>Description</th>
                            </tr>
                            <tr>
                                <td><code>&lt;agent&gt;</code></td>
                                <td>The name of the agent to send the task to.</td>
                            </tr>
                            <tr>
                                <td><code>[parameters...]</code></td>
                                <td>
                                    A space-separated list of parameters. Each parameter is a flag starting with <code>-</code> followed by its value.
                                    <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                                        <li><strong>Simple values:</strong> <code>-key value</code></li>
                                        <li><strong>Nested objects:</strong> <code>-object.key value</code></li>
                                        <li><strong>Arrays:</strong> <code>-array "[item1 item2 'item with spaces']"</code></li>
                                        <li><strong>Quoted values:</strong> <code>-key "value with spaces"</code></li>
                                    </ul>
                                </td>
                            </tr>
                        </table>

                        <h4>Examples</h4>
                        <pre><code># Simple key-value pairs
client task simulation -task montyHall -iterations 100

# Complex data with nested objects and arrays
client task myAgent -user.name "John Doe" -user.age 30 -permissions "[read write 'special access']"

# A mix of different types
client task anotherAgent -task process -config.level high -priority 1 -tags "[alpha beta]"
</code></pre>

                        <h3>client methods</h3>
                        <p>List available methods for an agent (if supported).</p>
                        <pre><code>client methods &lt;agent&gt;</code></pre>

                        <h3>client status</h3>
                        <p>Check agent health status.</p>
                        <pre><code>client status &lt;agent&gt;</code></pre>
                    </div>

                    <div class="doc-section" id="system">
                        <h2>System Management</h2>
                        
                        <h3>stop</h3>
                        <p>Stop all containers and services (preserves containers).</p>
                        <pre><code>stop</code></pre>

                        <h3>shutdown</h3>
                        <p>Stop and remove all workspace containers.</p>
                        <pre><code>shutdown</code></pre>

                        <h3>clean / destroy</h3>
                        <p>Remove all Ploinky containers from workspace.</p>
                        <pre><code>clean
destroy</code></pre>
                        <div class="alert alert-danger">
                            <strong>Warning:</strong> These commands are irreversible. All container data will be lost.
                        </div>
                    </div>

                    <div class="doc-section" id="logs">
                        <h2>Logging & Monitoring</h2>
                        
                        <h3>logs tail</h3>
                        <p>Follow router logs in real-time.</p>
                        <pre><code>logs tail [router]</code></pre>
                        <pre><code># Examples
logs tail router    # Follow router logs</code></pre>

                        <h3>logs last</h3>
                        <p>Show last N router log lines.</p>
                        <pre><code>logs last &lt;N&gt;</code></pre>
                        <pre><code># Examples
logs last 100           # Last 100 lines from router</code></pre>
                    </div>

                    <div class="doc-section">
                        <h2>Help System</h2>
                        
                        <h3>help</h3>
                        <p>Show general help or detailed help for specific commands.</p>
                        <pre><code>help [command]</code></pre>
                        <pre><code># Examples
help           # General help
help add       # Help for add command
help cli       # Help for cli command</code></pre>
                    </div>

                    <div class="doc-section">
                        <h2>Configuration Files</h2>
                        
                        <h3>.ploinky Directory Structure</h3>
                        <pre><code>.ploinky/
â”œâ”€â”€ agents/           # Agent registry
â”œâ”€â”€ repos/            # Downloaded repositories
â”œâ”€â”€ routing.json      # Router configuration
â”œâ”€â”€ .secrets          # Environment variables
â”œâ”€â”€ logs/             # Application logs
â”‚   â”œâ”€â”€ router.log
â”‚   â””â”€â”€ webtty.log
â””â”€â”€ running/          # PID files
    â”œâ”€â”€ router.pid
    â”œâ”€â”€ webtty.pid
    â”œâ”€â”€ webchat.pid
    â””â”€â”€ dashboard.pid</code></pre>

                        <h3>Agent Manifest (manifest.json)</h3>
                        <pre><code>{
  "container": "node:18-alpine",     // Container image
  "install": "npm install",          // Installation command
  "update": "npm update",            // Update command
  "cli": "node repl.js",            // CLI command for 'ploinky cli'
  "agent": "node server.js",        // Service command
  "about": "Description",           // Agent description
  "env": ["API_KEY", "DB_URL"],    // Required environment variables
  "enable": ["other-agent"],       // Auto-enable other agents
  "repos": {                       // Auto-add repositories
    "repo1": "https://..."
  }
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 Ploinky Project. Built with security and simplicity in mind.</p>
            <p>
                <a href="https://github.com/ploinky/ploinky">GitHub</a> â€¢ 
                <a href="index.html">Home</a> â€¢ 
                <a href="architecture.html">Architecture</a>
            </p>
        </div>
    </footer>

    <script>
        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        const savedTheme = localStorage.getItem('theme') || 'light';
        body.setAttribute('data-theme', savedTheme);
        themeToggle.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            themeToggle.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        });

        // Highlight active section in sidebar
        const sections = document.querySelectorAll('.doc-section[id]');
        const navLinks = document.querySelectorAll('.sidebar a');
        
        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= 100) {
                    current = section.getAttribute('id');
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
