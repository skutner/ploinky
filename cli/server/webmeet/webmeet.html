<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ploinky WebMeet</title>
  <link rel="icon" type="image/svg+xml" href="__ASSET_BASE__/webmeet-favicon.svg" />
  <link rel="stylesheet" href="__ASSET_BASE__/webmeet.css" />
  <style>
    .wa-header-actions .wa-icon-btn#participantsBtn{margin-left:6px}
    .vc-hint{color:#9aa0a6;font-size:12px}
    .wa-message-author{font-size:12px;color:var(--wa-muted);margin-bottom:3px}
    .vc-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:30;display:none}
    .vc-card{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(900px,92vw);background:var(--wa-bg-panel);color:var(--wa-text-primary);border:1px solid var(--wa-border);border-radius:10px;box-shadow:var(--wa-shadow-md);padding:14px}
    .vc-text{min-height:200px;max-height:60vh;resize:vertical;width:100%;background:var(--wa-bg-input);color:var(--wa-text-primary);border:1px solid var(--wa-border);border-radius:8px;padding:10px;font-family:inherit;font-size:14px}
    .vc-row{display:flex;gap:8px;align-items:center}
    .vc-row.right{justify-content:flex-end}
    .vc-select{background:var(--wa-bg-input);color:var(--wa-text-primary);border:1px solid var(--wa-border);border-radius:6px;padding:6px 8px}
    .vc-hint{color:var(--wa-text-secondary);font-size:12px}
    .wa-tts-btn{cursor:pointer;border:none;background:transparent;color:inherit;opacity:.7;transition:opacity .2s}
    .wa-tts-btn:hover{opacity:1}
    .vc-demo{opacity:.6}
    .vc-disconnect-mask{position:fixed;bottom:0;left:0;right:0;height:var(--wa-composer-height);background:rgba(0,0,0,0.7);z-index:15;display:none;pointer-events:none}
    .vc-disconnect-mask.show{display:block}
    .wa-participants-panel{position:relative;right:auto;top:auto;bottom:auto;width:280px;background:var(--wa-bg-panel);border-left:1px solid var(--wa-border);display:flex;flex-direction:column;flex:0 0 280px}
    .wa-participants-header{padding:16px;border-bottom:1px solid var(--wa-border)}
    .wa-participants-content{flex:1;overflow-y:auto;padding:16px}
    .wa-participant-item{display:flex;align-items:center;padding:8px;border-radius:6px;margin-bottom:4px}
    .wa-participant-item:hover{background:var(--wa-bg-hover)}
    .wa-participant-item .wa-participant-name{flex:1}
    .wa-participant-item .wa-participant-icons{display:flex;gap:8px;align-items:center;}
    .wa-speaking-icon{color:var(--wa-accent);font-size:16px}
    .wa-queue-icon{color:var(--wa-text-secondary);font-size:12px;font-weight:bold;border:1px solid var(--wa-text-secondary);border-radius:50%;width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;}
    #vc_disconnect_btn { width: 32px; height: 32px; color: var(--wa-text-secondary); }
    #vc_disconnect_btn:hover { color: var(--wa-danger); background: var(--wa-bg-hover); }
    .wa-composer .wa-icon-btn { width: 38px; height: 38px; }
    /* Participants panel sits in layout; no extra padding needed */
    body[data-page="chat"] .wa-main-content { padding-right: 0; }
    body[data-page="chat"] .wa-composer { margin-right: 0; }
    .wa-message.in { display: flex; align-items: center; gap: 8px; }
    .wa-message.in .wa-tts-btn { opacity: 0; }
    .wa-message.in:hover .wa-tts-btn { opacity: 0.7; }
    .wa-message.moderator .wa-message-bubble { border-color: var(--wa-accent); background: rgba(75,158,255,0.12); }
    .wa-message.moderator .wa-message-author { color: var(--wa-accent); }
    .wa-message.command .wa-message-bubble { font-style: italic; opacity: 0.85; }
    .wa-message.forbidden .wa-message-bubble { border-color: var(--wa-danger); background: rgba(255,75,75,0.08); color: var(--wa-danger); }
    .wa-message.forbidden .wa-message-author { color: var(--wa-danger); }
    .wa-message-bubble.is-forbidden .wa-message-time { color: var(--wa-danger); }
    .wa-message-bubble.moderated { border-color: var(--wa-accent); box-shadow: 0 0 0 1px rgba(75,158,255,0.2); }
    .wa-moderation-note { font-size: 11px; color: var(--wa-accent); text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 4px; }
    .wa-moderation-detail { font-size: 12px; color: var(--wa-text-secondary); margin-bottom: 6px; }
    
    /* Toolbar styles */
    .vc-toolbar { display: flex !important; gap: 4px; margin-top: 8px; padding: 4px; background: var(--wa-bg-hover); border-radius: 8px; flex-wrap: wrap; }
    .vc-toolbar-btn { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border: none; background: transparent; color: var(--wa-text-secondary); border-radius: 6px; cursor: pointer; transition: all 0.2s; position: relative; }
    .vc-toolbar-btn:hover { background: var(--wa-bg-input); color: var(--wa-text-primary); }
    .vc-toolbar-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .vc-toolbar-btn.active { background: var(--wa-accent); color: white; }
    .vc-toolbar-btn.danger:hover { background: rgba(255, 75, 75, 0.1); color: var(--wa-danger); }
    
    /* Responsive design */
    @media (max-width: 768px) {
      body[data-page="chat"] .wa-main-content { padding-right: 0; }
      body[data-page="chat"] .wa-composer { margin-right: 0; }
      /* On mobile, participants panel overlays as a drawer */
      .wa-participants-panel { position: fixed; width: 100%; right: -100%; top: var(--wa-header-height); bottom: 0; transition: right 0.3s ease; z-index: 20; }
      .wa-participants-panel.show { right: 0; }
      .wa-header-actions { gap: 4px; }
      .wa-icon-btn { width: 36px; height: 36px; }
      .wa-composer { padding: 6px 12px; }
      .wa-composer-input-wrapper { font-size: 14px; }
      .vc-card { width: min(95vw, 400px); padding: 12px; }
      .vc-text { min-height: 150px; max-height: 40vh; }
      #composer_actions { gap: 4px; }
    }
    
    @media (max-width: 480px) {
      .wa-header { padding: 0 12px; }
      .wa-header-title { font-size: 14px; }
      .wa-header-status { font-size: 11px; }
      .vc-toolbar { padding: 2px; gap: 2px; }
      .vc-toolbar-btn { width: 32px; height: 32px; }
    }
    
    /* Tooltip on desktop only */
    @media (hover: hover) and (pointer: fine) {
      .vc-toolbar-btn[title]:hover::after {
        content: attr(title);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        padding: 4px 8px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        font-size: 11px;
        white-space: nowrap;
        border-radius: 4px;
        pointer-events: none;
        margin-bottom: 4px;
        z-index: 1000;
      }
    }
  </style>
</head>
<body data-page="chat" data-theme="light" data-auth="__REQUIRES_AUTH__" data-base="__BASE_PATH__">
  <div class="wa-header">
    <div class="wa-header-avatar">
      <span>V</span>
    </div>
    <div class="wa-header-info">
      <div class="wa-header-title" id="titleBar">WebMeet</div>
      <div class="wa-header-status" id="status">
        <span class="wa-status-dot offline"></span>
        <span id="statusText">disconnected</span>
      </div>
    </div>
    <div class="wa-header-actions">
      <button class="wa-icon-btn" id="participantsToggle" title="Toggle participants">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5C15 14.17 10.33 13 8 13zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.96 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
      </button>
      <button class="wa-icon-btn" id="settingsBtn" title="Voice settings">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.3.06-.61.06-.94s-.02-.64-.06-.94l2.03-1.58a.5.5 0 0 0 .12-.64l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.07 7.07 0 0 0-1.63-.94l-.36-2.54A.5.5 0 0 0 14.9 2h-3.8a.5.5 0 0 0-.5.43l-.36 2.54a7.07 7.07 0 0 0-1.63.94l-2.39-.96a.5.5 0 0 0-.6.22L3.2 8.49a.5.5 0 0 0 .12.64l2.03 1.58c-.04.3-.06.61-.06.94s.02.64.06.94l-2.03 1.58a.5.5 0 0 0-.12.64l1.92 3.32a.5.5 0 0 0 .6.22l2.39-.96c.5.38 1.05.7 1.63.94l.36 2.54a.5.5 0 0 0 .5.43h3.8a.5.5 0 0 0 .5-.43l.36-2.54c.58-.24 1.13-.56 1.63-.94l2.39.96a.5.5 0 0 0 .6-.22l1.92-3.32a.5.5 0 0 0-.12-.64l-2.03-1.58zm-7.14 2.56a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z"/></svg>
      </button>
    </div>
  </div>

  <div class="wa-settings-panel" id="settingsPanel">
    <div class="wa-settings-header">Voice Settings</div>
    <label class="wa-settings-row">
      <input type="checkbox" id="sttEnable" checked />
      <span>Enable speech dictation</span>
    </label>
    <label class="wa-settings-row">
      <span class="wa-settings-label">Recognition language</span>
      <select id="sttLang"></select>
    </label>
    <label class="wa-settings-row">
      <span class="wa-settings-label">Theme</span>
      <select id="themeSelect">
        <option value="light">Light</option>
        <option value="dark">Dark</option>
      </select>
    </label>
  </div>

  <div class="wa-connection-banner" id="connBanner">
    <span id="bannerText">Connecting…</span>
  </div>

  <div class="wa-main-content">
    <div class="wa-chat-container" id="chatContainer">
      <div class="wa-chat-area" id="chatArea">
        <div class="wa-chat-bg"></div>
        <div class="wa-messages" id="chatList"></div>
      </div>
      <div class="wa-resizer" id="sidePanelResizer" aria-label="Resize panel" title="Drag to resize"></div>
      <div class="wa-side-panel" id="sidePanel">
        <div class="wa-side-panel-header">
          <h3 class="wa-side-panel-title">Full Message</h3>
          <button class="wa-side-panel-close" id="sidePanelClose" aria-label="Close">&times;</button>
        </div>
        <div class="wa-side-panel-content">
          <pre id="sidePanelContent"></pre>
        </div>
      </div>
      <!-- Participants panel moved inside chat-container to sit beside side panel -->
      <div id="participantsPanel" class="wa-participants-panel">
        <div class="wa-participants-header">
          <div class="wa-participants-header-row">
            <h3 id="participantsPanelTitle" class="wa-participants-title">Register</h3>
            <button type="button" class="vc-toolbar-btn" id="vc_connect_btn" title="Connect">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4s1.79-4 4-4h.71C7.37 7.69 9.48 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3s-1.34 3-3 3z"/></svg>
            </button>
          </div>
          <div class="wa-meeting-controls">
            <button class="wa-icon-btn" id="vc_mic_btn" title="Raise hand">
              <span style="font-size:18px;">✋</span>
            </button>
            <button class="wa-icon-btn" id="vc_mute_btn" title="Unmute microphone">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3a4 4 0 0 0-4 4v5a4 4 0 0 0 8 0V7a4 4 0 0 0-4-4zm6 8a6 6 0 0 1-12 0H4a8 8 0 0 0 16 0h-2zm-6-7a2 2 0 0 1 2 2v5a2 2 0 0 1-4 0V6a2 2 0 0 1 2-2z"/></svg>
            </button>
            <button class="wa-icon-btn" id="vc_deafen_btn" title="Deafen (mute others)">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M16 2a6 6 0 0 0-6 6v5c0 1.1-.9 2-2 2s-2-.9-2-2H4c0 2.2 1.8 4 4 4s4-1.8 4-4V8a4 4 0 0 1 8 0c0 1.6-.9 3-2.2 3.6V15c2.4-.7 4.2-3 4.2-5.6A6 6 0 0 0 16 2zm-1 18v2h-2v-2h2z"/></svg>
            </button>
            <button class="wa-icon-btn" id="vc_camera_btn" title="Turn camera on">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M17 7h-3V5a2 2 0 0 0-2-2H5C3.9 3 3 3.9 3 5v14c0 1.1.9 2 2 2h7a2 2 0 0 0 2-2v-2h3l4 3V4l-4 3z"/></svg>
            </button>
            <button class="wa-icon-btn" id="vc_screen_btn" title="Share screen">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M21 3H3c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h7v2H6v2h12v-2h-4v-2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 13H3V5h18v11z"/></svg>
            </button>
          </div>
          <form class="wa-participants-form" autocomplete="on" onsubmit="return false;">
            <input id="vc_email_input" type="email" name="email" autocomplete="email" placeholder="Enter email and press Enter to join" />
          </form>
        </div>
        <div class="wa-participants-content">
          <div style="margin-bottom:16px">
            <h4 style="margin:0 0 8px 0;font-size:14px;color:var(--wa-text-secondary)">Active Participants</h4>
            <div id="vc_participants_list" class="wa-participants-list"></div>
          </div>
          <div class="wa-video-panel">
            <div class="wa-video-header">
              <span id="vc_video_title">Preview</span>
              <span id="vc_video_hint">Camera off</span>
            </div>
            <div class="wa-video-shell">
              <video id="vc_video_preview" playsinline autoplay muted></video>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="wa-composer">
    <div class="wa-voice-control">
      <button class="wa-icon-btn" id="sttBtn" title="Voice dictation">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1.2-9.1c0-.66.54-1.2 1.2-1.2s1.2.54 1.2 1.2v6.2c0 .66-.54 1.2-1.2 1.2s-1.2-.54-1.2-1.2V4.9zm6.5 6.1c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.49 6-3.31 6-6.72h-1.7z"/></svg>
      </button>
      <span class="wa-voice-status" id="sttStatus">Off</span>
    </div>
    <div class="wa-composer-input-wrapper">
      <textarea 
        id="cmd" 
        class="wa-composer-input" 
        rows="1" 
        placeholder="Type or dictate a message"
        autocomplete="off"
      ></textarea>
    </div>
    <div class="wa-composer-actions" id="composer_actions">
      <button class="wa-send-btn" id="send" title="Send">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
      </button>
    </div>
  </div>

  <!-- Disconnected mask -->
  <div id="disconnectMask" class="vc-disconnect-mask"></div>

  <div id="screenOverlay" class="wa-screen-overlay">
    <div class="wa-screen-modal">
      <div class="wa-screen-modal-header">
        <span id="screenOverlayTitle">Screen share</span>
        <button id="screenOverlayClose" class="wa-icon-btn" title="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </div>
      <div class="wa-screen-modal-body">
        <video id="screenOverlayVideo" playsinline autoplay controls></video>
      </div>
    </div>
  </div>

  <!-- Load modular scripts -->
  <script src="__ASSET_BASE__/audio.js"></script>
  <script src="__ASSET_BASE__/showdemo.js"></script>
  <script src="__ASSET_BASE__/webmeet-store.js"></script>
  <script src="__ASSET_BASE__/webmeet-ui.js"></script>
  <script src="__ASSET_BASE__/webmeet-media.js"></script>
  <script src="__ASSET_BASE__/webrtc-room.js"></script>
  <script src="__ASSET_BASE__/webmeet-client.js"></script>
</body>
</html>
