---
name: DemoResourcePolicy Suite
description: Tests basic access behaviour for the demo_resource policy
principals:
  guest_user:
    id: guest_user
    roles:
      - guest
  normal_user:
    id: normal_user
    roles:
      - user
  admin_user:
    id: admin_user
    roles:
      - admin
  dev_user:
    id: dev_user
    roles:
      - dev

resources:
  demo_record:
    id: test_resource
    kind: demo_resource

tests:
  - name: Guest access
    input:
      principals:
        - guest_user
      resources:
        - demo_record
      actions:
        - read
        - create
        - update
        - delete
    expected:
      - principal: guest_user
        resource: demo_record
        actions:
          read: EFFECT_ALLOW
          create: EFFECT_DENY
          update: EFFECT_DENY
          delete: EFFECT_DENY

  - name: User access
    input:
      principals:
        - normal_user
      resources:
        - demo_record
      actions:
        - read
        - create
        - update
        - delete
    expected:
      - principal: normal_user
        resource: demo_record
        actions:
          read: EFFECT_ALLOW
          create: EFFECT_ALLOW
          update: EFFECT_DENY
          delete: EFFECT_DENY

  - name: Admin access
    input:
      principals:
        - admin_user
      resources:
        - demo_record
      actions:
        - read
        - create
        - update
        - delete
    expected:
      - principal: admin_user
        resource: demo_record
        actions:
          read: EFFECT_ALLOW
          create: EFFECT_ALLOW
          update: EFFECT_ALLOW
          delete: EFFECT_ALLOW

  - name: Dev access (no explicit grant)
    input:
      principals:
        - dev_user
      resources:
        - demo_record
      actions:
        - read
        - create
    expected:
      - principal: dev_user
        resource: demo_record
        actions:
          read: EFFECT_DENY
          create: EFFECT_DENY
